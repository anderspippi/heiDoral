//= vm-args "--gc=swiper --gc-verify"

class Foo(let x: Int)

fun main() {
    let a = Array[Long](70);
    let foo = Foo(17);
    let x = CardSpanningObject(foo);
    forceMinorCollect();
    assert(x.field0 === nil);
    assert(x.field64 === nil);

    x.field0 = Foo(1);
    forceMinorCollect();
    assert(x.field0.x == 1);
    assert(x.field64 === nil);

    forceMinorCollect();
    assert(x.field0.x == 1);
    assert(x.field64 === nil);
}

class CardSpanningObject(foo: Foo) {
    var field0: Foo = foo;
    var field1: Foo = foo;
    var field2: Foo = foo;
    var field3: Foo = foo;
    var field4: Foo = foo;
    var field5: Foo = foo;
    var field6: Foo = foo;
    var field7: Foo = foo;
    var field8: Foo = foo;
    var field9: Foo = foo;
    var field10: Foo = foo;
    var field11: Foo = foo;
    var field12: Foo = foo;
    var field13: Foo = foo;
    var field14: Foo = foo;
    var field15: Foo = foo;
    var field16: Foo = foo;
    var field17: Foo = foo;
    var field18: Foo = foo;
    var field19: Foo = foo;
    var field20: Foo = foo;
    var field21: Foo = foo;
    var field22: Foo = foo;
    var field23: Foo = foo;
    var field24: Foo = foo;
    var field25: Foo = foo;
    var field26: Foo = foo;
    var field27: Foo = foo;
    var field28: Foo = foo;
    var field29: Foo = foo;
    var field30: Foo = foo;
    var field31: Foo = foo;
    var field32: Foo = foo;
    var field33: Foo = foo;
    var field34: Foo = foo;
    var field35: Foo = foo;
    var field36: Foo = foo;
    var field37: Foo = foo;
    var field38: Foo = foo;
    var field39: Foo = foo;
    var field40: Foo = foo;
    var field41: Foo = foo;
    var field42: Foo = foo;
    var field43: Foo = foo;
    var field44: Foo = foo;
    var field45: Foo = foo;
    var field46: Foo = foo;
    var field47: Foo = foo;
    var field48: Foo = foo;
    var field49: Foo = foo;
    var field50: Foo = foo;
    var field51: Foo = foo;
    var field52: Foo = foo;
    var field53: Foo = foo;
    var field54: Foo = foo;
    var field55: Foo = foo;
    var field56: Foo = foo;
    var field57: Foo = foo;
    var field58: Foo = foo;
    var field59: Foo = foo;
    var field60: Foo = foo;
    var field61: Foo = foo;
    var field62: Foo = foo;
    var field63: Foo = foo;
    var field64: Foo = foo;
}