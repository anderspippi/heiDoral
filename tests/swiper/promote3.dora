//= vm-args "--gc=swiper --gc-verify"

fun main() {
  var x = Foo(1I, Foo(2I, Foo(3I, nil)));
  forceMinorCollect();
  x.next.next.next = Foo(4I, nil);
  x = Foo(100I, x);
  forceMinorCollect();
  assert(x.a == 100I);
  assert(x.next.a == 1I);
  assert(x.next.next.a == 2I);
  assert(x.next.next.next.a == 3I);
  assert(x.next.next.next.next.a == 4I);
  assert(x.next.next.next.next.next === nil);
}

class Foo(let a: Int32, var next: Foo)
