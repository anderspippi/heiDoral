//= stdout "done\ndone\n"
//= vm-args "--gc-young-size=64M --max-heap-size=128M"

class MyThread() : Thread {
    @override fun run() {
        allocator();
        println("done");
    }
}

fun main() {
    let thread = MyThread();
    thread.start();

    allocator();
    println("done");
}

fun allocator() {
    var i = 0;

    while i < 10_000 {
        let v1 = Foo(none[Foo]());
        let v2 = Foo(some[Foo](v1));
        let v3 = Foo(some[Foo](v2));
        let v4 = Foo(some[Foo](v3));
        let v5 = Foo(some[Foo](v4));
        if i % 500 == 0 { forceMinorCollect(); }
        i = i + 1;
    }
}

class Foo(let next: Option[Foo])